---
- name: Create local certificate directory
  ansible.builtin.file:
    path: /usr/local/share/ca-certificates
    state: directory
    owner: root
    group: root
    mode: 0755

- name: Check if root certificate exists
  delegate_to: localhost
  become: no
  ansible.builtin.stat: path="{{ playbook_dir }}/certificates/root_ca.crt"
  register: _root_cert

- name: Copy root certificate
  ansible.builtin.copy:
    src: "{{ playbook_dir }}/certificates/root_ca.crt"
    dest: "/usr/local/share/ca-certificates/{{ domain | regex_replace('\\.', '_') }}.crt"
    owner: root
    group: root
    mode: 0700
  when: _root_cert.stat.exists
  notify: Update CA Certificates
